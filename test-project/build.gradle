apply plugin: 'java'
apply plugin: 'gae'
apply plugin: 'gaelyk'
apply plugin: 'gae-geb'


ext {
	compatibilityVersion = 1.5
}
sourceCompatibility = compatibilityVersion
targetCompatibility = compatibilityVersion

buildscript {
	repositories {
		mavenCentral()
		//mavenLocal()
		maven {
			url = 'https://oss.sonatype.org/content/repositories/orggradleapiplugins-548/'
		}
	}

	dependencies {
		classpath 'org.gradle.api.plugins:gradle-gae-plugin:0.7.2'
		classpath 'org.gradle.api.plugins:gradle-gaelyk-plugin:0.3.2'
		classpath 'eu.appsatori:gradle-fatjar-plugin:0.1.1'
		classpath 'org.gradle.api.plugins:gradle-gae-geb-plugin:0.1'
	}
}

dependencies {
	compile "org.gaelyk:gaelyk:$gaelykVersion",
		project(':gaelyk-remote')

	gaeSdk "com.google.appengine:appengine-java-sdk:$gaeVersion"
}

gae {
	downloadSdk = true
	optimizeWar = true
	warDir = file('src/main/webapp/')
}

gaeExplodeWar.dependsOn gaelykPrecompileGroovlet
gaeExplodeWar.dependsOn gaelykPrecompileTemplate

sourceSets.main.output.classesDir = 'src/main/webapp/WEB-INF/classes'

clean {
	delete sourceSets*.output.classesDir
}

task copyRuntimeLibraries(type: Sync) {
	def webAppLibDirName = 'src/main/webapp/WEB-INF/lib'
	description = "Copies runtime libraries to $webAppLibDirName."
	from configurations.runtime
	into webAppLibDirName
}

gaeRun.dependsOn copyRuntimeLibraries